
<!-----------------------------------JQUERY---------------------------------------------->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<style>
       .SearchWrapper {
              -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              border-bottom: solid black 1px;
              margin-bottom: 0.25em;
              padding-bottom: 0.25em;
              padding-top: 0.25em;
              border-radius: 1em;
              background-color: lightblue;
       }
       .SearchHead {
              -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              border-bottom: solid black 1px;
              border-radius: 0.5em;
              background-color: #ffffff;
              padding-bottom: 0.25em;
              padding-top: 0.25em;
       }
       .EntityWrapper {
              padding-bottom:1.25em;
              padding-top: 1.5em;
       }
       .EntityShadow {
              border-radius: 1em;
              -webkit-box-shadow: 0px 5px 7px 0px rgba(0,0,0,0.75);
              -moz-box-shadow: 0px 5px 7px 0px rgba(0,0,0,0.75);
              box-shadow: 0px 5px 7px 0px rgba(0,0,0,0.75);
       }
       .EntityShadowInset {
              -webkit-box-shadow: inset 0px 0px 19px -3px rgba(0,0,0,0.75);
              -moz-box-shadow: inset 0px 0px 19px -3px rgba(0,0,0,0.75);
              box-shadow: inset 0px 0px 19px -3px rgba(0,0,0,0.75);
       }

       .AttributeWrapper {
              background-color: lightblue;
              border-radius: 0.5em;
              -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              padding: 0.25em;
              padding-bottom:1em;
              margin-top: 0.2222em;
              margin-bottom: 0.2222em;
       }
       .AttributeWrapper input{width: 99%}
       .AttributeWrapper textarea{width: 99%}
       .AttributeWrapper span{font-weight: bold;}

       .RelationWrapper {
              background-color: white;
              border-radius: 0.5em;
              -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
              padding: 0.25em;
              padding-bottom:1em;
              margin-top: 0.2222em;
              margin-bottom: 0.2222em;
       }
</style>

<div class = "mainContentWrapper">
       <div class = container-fluid>
              <div class="col-sm-12 col-md-12 col-lg-12">
                     <div class="tabWrapper">
                            <div class="tabHead">
                                   <button onclick="switchTab(event, '.ContentTab')" class="selected">Hello</button>
                                   <button onclick="switchTab(event, '.MachinaTab')">Settings</button>
                            </div>
                            <div class="tabBody">
                                   <div class="ContentTab row">
                                          <h2> Hello! This is the CRUD plugin! </h2>
                                   </div>
                                   <div class="MachinaTab row" style="display:none">
                                          <div
                                                  class="col-sm-12 col-md-12"
                                          >
                                                 <button id="crud_world_redirect_button">Reload this world!</button>
                                          </div>
                                          <div
                                                  class="col-sm-12 col-md-12"
                                          >
                                                 <h3>Your World Source :</h3>
                                          </div>
                                          <div
                                                  class="col-sm-12 col-md-12"
                                          >
                                                 <input
                                                         id="jdbc_world_url"
                                                         style="width:100%;text-align: center;"
                                                         placeholder="sql-world source folder"
                                                 >
                                          </div>
                                          <div
                                                  class="col-sm-12 col-md-12"
                                          >
                                                 <h3>JDBC Source File :</h3>
                                          </div>
                                          <
                                                  class="col-sm-12 col-md-12"
                                          >
                                                 <input
                                                         id="sql_world_source"
                                                         style="width:100%;text-align: center;"
                                                         placeholder="db-world source file"
                                                 ><br>
                                                 <span>Examples:</span><br>
                                                 jdbc:sqlite:C:/sqlite/db/TailDB<br>
                                                 jdbc:sqlite:C:/sqlite/db/TestDB<br>
                                                 <button id="set_crud_world_button">Set DB</button>
                                                 <div
                                                         id="set_crud_world_response_button"
                                                         class="contentBox"
                                                 >
                                                        ...response...
                                                 </div>
                                          </div>
                                   </div>
                            </div>
                     </div>
              </div>
       </div>
</div>
<script>
       $(document).ready( function() {
              $('#crud_world_redirect_button').click(function() {
                     window.location = window.location.origin+'/tailworld.html';
              });
              $('#set_crud_world_button').click(function() {
                     $('#set_crud_world_response_button')
                             .load('CRUD/setJDBC?db_url='+$('#jdbc_world_url').val()+'&sql_source='+$('#sql_world_source').val());
              });
       });

       function loadFoundForEntity( tableName ) {
              sendAndSet(
                      $('#' + tableName + '_search').children('input, textarea'),
                      $('#' + tableName + '_result'),
                      'CRUD/find/' + tableName,
                      function( response, status, xhr ) {
                             if ( status === "error" ) {
                                    alert('Finding failed!\nStatus: '+status+'\nResponse: '+response);
                             }
                      }
              );
       }

       function loadQuickSearchForEntity( tableName ) {
              sendAndSet(
                      $('#' + tableName + '_search').children('input, textarea'),
                      $('#' + tableName + '_result'),
                      'CRUD/find/' + tableName + '?searchQuickly=true',
                      function( response, status, xhr ) {
                             if ( status === "error" ) {
                                    alert('Finding failed!\nStatus: '+status+'\nResponse: '+response);
                             }
                      }
              );
       }

       function loadSavedForRelation(
               relationTableName, relationID, relationUrl,
               outerTableName, outerID, outerUrl, afterLoad
       ) {
              console.log(relationTableName +"|"+ relationID +"|"+ relationUrl +"|"+
                      outerTableName +"|"+ outerID +"|"+ outerUrl);
              _loadSavedForEntity(relationTableName, relationID+"_related", relationUrl, function () {
                     _loadSavedForEntity(outerTableName, outerID+"_related", outerUrl, afterLoad);
              });

       }

       function loadSavedForEntity( tableName, id, urlSearchParams ) {
              _loadSavedForEntity( tableName, id, urlSearchParams, function(){} );
       }

       function _loadSavedForEntity( tableName, id, urlSearchParams, afterLoad ) {
              let entity = $('#' + tableName+'_'+id);
              sendAndSet(
                      entity
                              .children('.tabWrapper')
                              .children('.tabBody')
                              .children('div')
                              .children('div')
                              .children('.AttributeWrapper')
                              .children('input, textarea'),
                      entity,
                      'CRUD/save/' + tableName + urlSearchParams+' #' + tableName+'_'+id+' > *',
                      function( response, status, xhr ) {
                             if( status === "error" ) {
                                    entity.replaceWith("");
                                    alert('Saving failed!\nStatus: '+status);
                             } else if( entity.html()==="" ) {
                                    entity.replaceWith(response);
                                    entity
                                            .children('.tabWrapper')
                                            .children('.tabBody')
                                            .children('div')
                                            .children('div')
                                            .children('.AttributeWrapper')
                                            .children('textarea').first().focus();
                             }
                             afterLoad();
                      }
              );
       }

       function deleteEntity( tableName, id ) {
              if(confirm("Do you really want to delete this entity?\nType: '"+tableName+"', id: '"+id+"'")){
                     let entity = $( '#' + tableName + '_' + id );
                     sendAndSet(
                             entity
                                     .children('.tabWrapper')
                                     .children('.tabBody')
                                     .children('div')
                                     .children('div')
                                     .children('.AttributeWrapper')
                                     .children('input, textarea'),
                             entity,
                             'CRUD/delete/' + tableName+' #' + tableName+'_'+id+' > *',
                             function( response, status, xhr ) {
                                    if(status === "error") {
                                           entity.replaceWith(response);
                                           alert('Deletion failed!\nStatus: '+status);
                                    } else {
                                           eval(response);
                                    }// else if( entity.html()==="" ) {entity.replaceWith(response);}
                             }
                     );
              }
       }

       function sendAndSet(fromSelector, intoSelector, url, callback) {
              var params = {};
              fromSelector.each(function () { params[this.name] = this.value; });
              intoSelector.html("").load(url, params, callback);
       }

       function noteOnInputFor( attribute, tableName, id )
       {
              let element = $('#'+tableName+'_'+id+'_'+attribute);
              element.attr('value',parseInt(element.attr('value'))+1);
              if( parseInt(element.attr('value'))>175 ) {
                     element.attr('value',0);
                     loadSavedForEntity(tableName, id);
              }
       }

       function switchTab(src, target) {
              var tabBody = $(src.target).parent().parent().find('.tabBody');
              tabBody.children().css("display", "none");
              $(src.target).siblings().removeClass("selected");
              $(src.target).addClass("selected");
              $(src.target).parent().parent().children('.tabBody').children(target).css("display", "flex");
       }
</script>

