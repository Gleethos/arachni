
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title id="crud_world_page_title"> CRUDWORLD </title>
        <link rel="icon" href="/src/favicon/favicon.ico" >
        <meta name="description" content="a world of tails">
        <meta name="author" content="Daniel Nepp">
        <meta name="keywords" content="Story, Tail">
        <!-----------------------------------ROBOTS---------------------------------------------->
        <meta name="robots" content="all">
        <meta name="revisit-after" content="30 days">
        <!-----------------------------------JQUERY---------------------------------------------->
        <script src="../../../../webroot/src/js/jquery.min.js"></script>
        <!-----------------------------------BOOTSTRAP------------------------------------------>
        <link rel="stylesheet" href="../../../../webroot/src/css/bootstrap.min.css">
        <script src="../../../../webroot/src/js/bootstrap.min.js"></script>
        <script src="../../../../webroot/src/js/popper.min.js"></script>
        <!-----------------------------------CUSTOM CSS------------------------------------------>
        <link rel="stylesheet" href="../../../../webroot/src/css/style.css">
        <!-----------------------------------VANTA---------------------------------------------->
        <script src="../../../../webroot/src/js/three.min.js"></script>
        <script src="../../../../webroot/src/js/vanta.birds.min.js"></script>
        <script>
            function updateTopBar( event ) {
                let top = $('#main_with_parallax').scrollTop();
                if( top > 25 && top < 2750 ) {
                    let tippingPoint = 200;
                    let smoothness = 25;
                    let sig = 1-sigmoid((top-tippingPoint)/smoothness);
                    let newTop = sig*65+5;
                    $('.gaadiexp').css({top:(newTop/2)-5});
                    $('.side-nav').css({top:37+(newTop/2)});
                    $('#top_most_nav_bar').css({height: newTop});
                    $('#navbar_menu').css({top:newTop/2});
                    $('#crud_world_title').css({'font-size':(2+sig/2)+"rem"});
                }
            }
            function sigmoid(t) {return 1/(1+Math.pow(Math.E, -t));}

            // Prevent the backspace key from navigating back.
            //$(document).unbind('keydown').bind('keydown', function (event) {
            //    if (event.keyCode === 8) {
            //        var doPrevent = true;
            //        var types = ["text", "password", "file", "search", "email", "number", "date", "color", "datetime", "datetime-local", "month", "range", "search", "tel", "time", "url", "week"];
            //        var d = $(event.srcElement || event.target);
            //        var disabled = d.prop("readonly") || d.prop("disabled");
            //        if (!disabled) {
            //            if (d[0].isContentEditable) {
            //                doPrevent = false;
            //            } else if (d.is("input")) {
            //                var type = d.attr("type");
            //                if (type) {
            //                    type = type.toLowerCase();
            //                }
            //                if (types.indexOf(type) > -1) {
            //                    doPrevent = false;
            //                }
            //            } else if (d.is("textarea")) {
            //                doPrevent = false;
            //            }
            //        }
            //        if (doPrevent) {
            //            event.preventDefault();
            //            return false;
            //        }
            //    }
            //});
        </script>
        <style>
            .SearchWrapper {
                -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                border-bottom: solid black 1px;
                margin: 0.5em;
                padding-bottom: 0.25em;
                padding-top: 1em;
                border-radius: 1em;
                background-color: lightblue;
            }
            .SearchHead {
                -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                border-bottom: solid black 1px;
                border-radius: 0.5em;
                background-color: #ffffff;
                padding-bottom: 0.25em;
                padding-top: 0.25em;
            }
            .EntityWrapper {
                padding-top: 1.5em;
                height:100%;
            }
            .EntityShadow {
                border-radius: 1em;
                -webkit-box-shadow: 0px 5px 7px 0px rgba(0,0,0,0.75);
                -moz-box-shadow: 0px 5px 7px 0px rgba(0,0,0,0.75);
                box-shadow: 0px 5px 7px 0px rgba(0,0,0,0.75);
            }
            .EntityShadowInset {
                -webkit-box-shadow: inset 0px 0px 19px -3px rgba(0,0,0,0.75);
                -moz-box-shadow: inset 0px 0px 19px -3px rgba(0,0,0,0.75);
                box-shadow: inset 0px 0px 19px -3px rgba(0,0,0,0.75);
            }
            .AttributeWrapper {
                background-color: lightblue;
                border-radius: 0.5em;
                -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                padding: 0.25em;
                padding-bottom:1em;
                margin-top: 0.2222em;
                margin-bottom: 0.2222em;
            }
            .AttributeWrapper input{width: 99%}
            .AttributeWrapper textarea{width: 99%}
            .AttributeWrapper span{font-weight: bold;}

            .RelationWrapper {
                background-color: white;
                border-radius: 0.5em;
                -webkit-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                -moz-box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                box-shadow: 0px 0px 5px -1px rgba(0,0,0,0.75);
                padding: 0.25em;
                padding-bottom:1em;
                margin-top: 0.2222em;
                margin-bottom: 0.2222em;
            }
        </style>
    </head>
    <body>
        <div id="header">
            <div id="BirdBox" class="MainFrame" style="background-image: url('../../../../webroot/src/img/distant_bgr.jpg');">

                <nav class="" id="top_most_nav_bar">
                    <div id="navigation_container" class="">
                        <div style = "" class = "topEarthGradient DynamicSideMargin">
                            <h1 id="crud_world_title">CRUDWORLD</h1>
                        </div>
                        <div class="pull-right nightBox" id="navbar_menu" style="display:none">
                            <ul class="nav navbar-right" id="navbar_list">
                                <li>
                                    <a href="../../../../webroot/index.html">
                                        <img src="../../../../webroot/src/img/icons/house.png">
                                    </a>
                                </li>
                                <li>
                                    <a href="https://github.com/Gleethos/arachni">
                                        <img src="../../../../webroot/src/img/icons/github-logo.png">
                                    </a>
                                </li>
                                <li>
                                    <a href="webroot/src/index.html">
                                        <img src="../../../../webroot/src/img/icons/cogwheel.png">
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div id="navi" style="display:none">
                        <input type="checkbox" name="mobile-nav" id="mobile-nav" class="gaadiexp-check" onchange="this.blur()">
                        <label for="mobile-nav" class="gaadiexp white" tabindex="0" style="margin-left: 0;"><span></span></label>
                        <div role="navigation" class="header-nav">
                            <div class="fixed-nav">
                                <div class="menu">
                                    <ul class="side-nav">
                                        <li></li>
                                        <li></li>
                                        <li><a target="_blank" Style="cursor: pointer; color: cyan;" onclick="loadCRUDView('../TOC')">Table Of Content</a></li>
                                        <li><a target="_blank" href="../../../../webroot/index.html">Home</a></li>
                                        <li><a target="_blank" href="main/index.html">Documentation</a></li>
                                        <li><a target="_blank" href="https://github.com/Gleethos/arachni">Github</a></li>
                                        <li><a target="_blank" href="">Introduction</a></li>
                                        <li><a target="_blank" href="">Reasons</a></li>
                                        <li><a target="" href="coverage/test/html/index.html">Code Coverage</a>
                                        <li><a target="" href="coverage/test/html/jacoco-sessions.html">Last Test Session</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

                <!----------------------------------LAYOUT------------------------------------------------->
                <main class="Parallax" id="main_with_parallax" onscroll="updateTopBar(event);">
                    <div style="left:-10px;" class="ParallaxLayer ParallaxLayer--back ">
                        <div>
                            <image src="src/img/parallax/woods.png"></image>
                        </div>
                    </div>
                    <div class="ParallaxLayer">
                        <div id="main_content_tile" class="cardBox DynamicSideMargin">

                            <div class = "mainContentWrapper">
                                <div class = container-fluid>
                                    <h1 id = "content_title"></h1>
                                    <button id = "reload_crud_button">RELOAD</button>
                                </div>
                            </div>
                            <div class = "mainContentWrapper">
                                <div class = container-fluid>
                                    <div class="col-sm-12 col-md-12 col-lg-12">
                                        <div class="tabWrapper">
                                            <div class="tabHead">
                                                <button id="welcome_introduction_button" onclick="switchTab(event, '.ContentTab')" class="">Welcome</button>
                                                <button id="database_settings_button" onclick="switchTab(event, '.MachinaTab')">Settings</button>
                                            </div>
                                            <div class="tabBody">
                                                <div class="ContentTab row" style="display:none">
                                                    <div class="col-sm-12 col-md-12">
                                                        <h2> What is 'CRUD-World' ? </h2>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12 ContentWrapper">
                                                        <p>
                                                            'CRUD' means Create-Read-Update-Write!<br>
                                                            This Web-Interface is the skin of a so called CRUD-Controller.<br>
                                                            Which is a complicated piece of software responsible for building
                                                            a user friendly experience for managing Data-Entities! :) <br>
                                                            <br>
                                                            Data-Entity? <br>
                                                            Basically, it is a simple entry within a table stored in a
                                                            database. An entry is merely one row of a given table.
                                                            Such entities are converted into modifiable forms which
                                                            can be created, read, updated, and deleted.<br>
                                                            That's it! :) Have fun!
                                                        </p>
                                                    </div>
                                                </div>
                                                <div class="MachinaTab row" style="display:none">
                                                    <div class="col-sm-12 col-md-12">
                                                        <button id="crud_world_redirect_button">Reload this world!</button>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12">
                                                        <h3>Your World Bootstrap :</h3>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12">
                                                        <input
                                                                id="sql_world_source"
                                                                style="width:100%;text-align: center;"
                                                                placeholder="sql-world source folder"
                                                        ><br>
                                                        <span>Available:</span><br>
                                                        <div id="sql_source_file_option_menu">
                                                            --<#AVAILABLE#SQL#SOURCES#>--
                                                        </div>
                                                        <button id="load_crud_world_sql_button">Bootstrap SQL</button>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12">
                                                        <h3>Your World Database :</h3>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12">
                                                        <input
                                                                id="jdbc_world_url"
                                                                style="width:100%;text-align: center;"
                                                                placeholder="db-world source file"
                                                        ><br>
                                                        <span>Available:</span><br>
                                                        <div id="database_file_option_menu">
                                                            --<#AVAILABLE#DATABASES#>--
                                                        </div>
                                                        <button id="set_crud_world_db_button">Set DB</button>
                                                    </div>
                                                    <div class="col-sm-12 col-md-12">
                                                        <div
                                                                id="set_crud_world_response_button"
                                                                class="ContentContainer"
                                                        >
                                                            ...response...
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <script>
                                function loadCRUDView( target ) {
                                    $('#dynamic_content').hide("fast", function() {
                                        $('#content_title').hide("fast", function(){
                                            var split = target.split("/");
                                            split = split[split.length-1];
                                            $('#content_title').html(split.charAt(0).toUpperCase() + split.substring(1)).show("fast");
                                        });
                                        $('#dynamic_content').html("").load('CRUD/'+target);
                                    });
                                    setTimeout(function() {$('#dynamic_content').show("fast");}, 500);
                                }
                                $(document).ready(function(){
                                    setTimeout(function() {loadCRUDView('world');}, 200);
                                    $('#reload_crud_button').click(function() {loadCRUDView('world');});
                                });
                                $(document).ready( function() {
                                    $('#crud_world_redirect_button').click(function() {
                                        window.location = window.location.origin+'/crud';
                                    });
                                    $('#set_crud_world_db_button').click(function() {
                                        var url = $('#jdbc_world_url');
                                        $('#set_crud_world_response_button').load('CRUD/setJDBC?db_url='+url.val());
                                        var newTitle = url.val().split("/");
                                        newTitle = newTitle[newTitle.length-1];
                                        $('#crud_world_page_title').html(newTitle);
                                        $('#crud_world_title').html(newTitle);
                                        loadCRUDView('world');
                                    });
                                    $('#load_crud_world_sql_button').click(function() {
                                        var sql = $('#sql_world_source');
                                        if(
                                            confirm(
                                                "Do you really want to bootstrap '"+sql.val()+"' ?\n" +
                                                "Tables might be dropped and their data would be lost permanently!"
                                            )
                                        ) {
                                            $('#set_crud_world_response_button').load('CRUD/setJDBC?sql_source='+sql.val());
                                            loadCRUDView('world');
                                        }
                                    })
                                });
                            </script>


                            <script>

                                function loadFoundForEntity( tableName, uid, afterLoad ) {
                                    let identifier = tableName + ((uid==='')?'':'_'+uid);
                                    let urlAppend = (uid==='')?'':'?uid='+uid;
                                    let appendRelations = (uid==='')?'':'&appendRelations=false';
                                    sendAndSet(
                                        $('#' + identifier + '_search').children('input, textarea'),
                                        $('#' + identifier + '_result'),
                                        'CRUD/find/' + tableName + urlAppend + appendRelations,
                                        function( response, status, xhr ) {
                                            if ( status === "error" ) {
                                                alert('Finding failed!\nStatus: '+status+'\nResponse: '+response);
                                            }
                                            afterLoad();
                                        }
                                    );
                                }

                                function loadQuickSearchForEntity( tableName, uid ) {
                                    let identifier = tableName +((uid==='')?'':'_'+uid);
                                    let uidAppend = (uid==='')?'':'&uid='+uid;
                                    let appendRelations = (uid==='')?'':'&appendRelations=false';
                                    sendAndSet(
                                        $('#' + identifier + '_search').children('input, textarea'), // from
                                        $('#' + identifier + '_result'), // into
                                        'CRUD/find/' + tableName + '?searchQuickly=true' + uidAppend + appendRelations,
                                        function( response, status, xhr ) {
                                            if ( status === "error" ) {
                                                alert('Finding failed!\nStatus: '+status+'\nResponse: '+response);
                                            }
                                        }
                                    );
                                }

                                function loadRelationalQuickSearchForEntity(
                                    innerTableName,
                                    relationTableName,
                                    outerTableName,
                                    innerKey,
                                    outerKey,
                                    uid
                                ) {
                                    let uniqueInner = innerTableName + ((uid==='')?'':'_'+uid);
                                    let uidAppend = (uid==='')?'':'&uid='+uid;
                                    let appendRelations = (uid==='')?'':'&appendRelations=false';
                                    console.log("Relational quick search for : '"+innerTableName+"' ; Unique: '"+uniqueInner+"'");
                                    console.log("Relation : '"+relationTableName+"'");
                                    console.log("Outer table : '"+outerTableName+"'");
                                    let relationValue = $('#'+relationTableName+"_quick_search_joined_with_"+uniqueInner+"_"+innerKey+"_and_"+outerTableName+"_"+outerKey).val();
                                    let outerValue = $('#'+outerTableName+"_"+outerKey+"_quick_search_joined_with_"+relationTableName+"_and_"+uniqueInner+"_"+innerKey).val();
                                    let innerValue = $('#'+uniqueInner+"_quick_search_input").val();
                                    let url =
                                    "CRUD/find/"+innerTableName+"->"+relationTableName+"->"+outerTableName+"?" +
                                    "searchQuickly=true&" +
                                    innerTableName+"_inner_quick_search_parameter="+innerValue+"&" +
                                    relationTableName+"_relation_quick_search_parameter="+relationValue+"&" +
                                    outerTableName+"_outer_quick_search_parameter="+outerValue+"&" +
                                    "key_relation="+innerKey+"->"+outerKey +
                                    uidAppend+appendRelations;
                                    console.log("Loading for url : \n"+url);
                                    $('#' + uniqueInner + '_result').html("").load(url);
                                }

                                function loadSavedForRelation(
                                    relationTableName, relationID,
                                    outerTableName, outerID,
                                    outerKey, idClass, uid,
                                    afterLoad
                                ) {
                                    _loadSavedForEntity(outerTableName, outerID+"_related", '?appendRelations=false', function () {
                                        var newID = $('#'+outerTableName+"_"+uid).find('.'+idClass).val();
                                        console.log("Joined entity '"+outerTableName+"' with id '"+outerID+"' saved and loaded : ");
                                        console.log("Returned ID: $('#"+outerTableName+"_"+uid+"').find('."+idClass+"').val() == '"+newID+"'\n");
                                        var relationTableJoinField = $('#'+relationTableName+"_"+uid).find('#'+relationTableName+'_'+relationID+'_'+outerKey);
                                        console.log("Joining relation entity '"+relationTableName+"' with id '"+relationID+"' joins by attribute '"+outerKey+"' !");
                                        console.log("Joining key '"+outerKey+"' currently :");
                                        console.log("$('#"+relationTableName+"_"+uid+"').find('#"+relationTableName+'_'+relationID+'_'+outerKey+"').val() == '"+relationTableJoinField.val()+"'");
                                        console.log("... will bew replaced by id '"+newID+"' of joined entity !\n");
                                        relationTableJoinField.val(newID);
                                        _loadSavedForEntity(relationTableName, relationID+"_related", '?appendRelations=false&appendButtons=false', afterLoad);
                                    });
                                }

                                function loadSavedForEntity( tableName, id, urlSearchParams ) {
                                    console.log("\nSaving and loading entity...  table : '"+tableName+"', id : '"+id+"', url : '"+urlSearchParams+"'");
                                    _loadSavedForEntity( tableName, id, urlSearchParams, function(){
                                        console.log("Saving and loading table '"+tableName+"' with id '"+id+"' and url '"+urlSearchParams+"' done!\n");
                                    } );
                                }

                                function _loadSavedForEntity( tableName, id, urlSearchParams, afterLoad ) {
                                    let entity = $('#' + tableName+'_'+id);
                                    console.log("Saving and loading entity by DOM id  :  $('#"+tableName+"_"+id+"')");
                                    let ajaxUrl = 'CRUD/save/' + tableName + urlSearchParams+' #' + tableName+'_'+id+' > *';
                                    console.log("Ajax url : '"+ajaxUrl+"'")
                                    sendAndSet(
                                        entity
                                            .children('.tabWrapper')
                                            .children('.tabBody')
                                            .children('div')
                                            .children('div')
                                            .children('.AttributeWrapper')
                                            .children('input, textarea'),
                                        entity,
                                        ajaxUrl,
                                        function( response, status, xhr ) {
                                            if( status === "error" ) {
                                                entity.replaceWith("");
                                                alert('Saving failed!\nStatus: '+status);
                                            } else if( entity.html()==="" ) {
                                                entity.replaceWith(response);
                                                entity
                                                    .children('.tabWrapper')
                                                    .children('.tabBody')
                                                    .children('div')
                                                    .children('div')
                                                    .children('.AttributeWrapper')
                                                    .children('textarea').first().focus();
                                            }
                                            afterLoad();
                                        }
                                    );
                                }

                                function deleteEntity( tableName, id ) {
                                    if(confirm("Do you really want to delete this entity?\nType: '"+tableName+"', id: '"+id+"'")){
                                        let entity = $( '#' + tableName + '_' + id );
                                        sendAndSet(
                                            entity
                                                .children('.tabWrapper')
                                                .children('.tabBody')
                                                .children('div')
                                                .children('div')
                                                .children('.AttributeWrapper')
                                                .children('input, textarea'),
                                            entity,
                                            'CRUD/delete/' + tableName+' #' + tableName+'_'+id+' > *',
                                            function( response, status, xhr ) {
                                                if(status === "error") {
                                                    entity.replaceWith(response);
                                                    alert('Deletion failed!\nStatus: '+status);
                                                } else {
                                                    eval(response);
                                                }// else if( entity.html()==="" ) {entity.replaceWith(response);}
                                            }
                                        );
                                    }
                                }

                                function sendAndSet(fromSelector, intoSelector, url, callback) {
                                    var params = {};
                                    fromSelector.each(function () { params[this.name] = this.value; });
                                    console.log("The following will be sent:")
                                    $.each(params, function(key, data) {console.log(key + ' -> ' + data);});
                                    console.log("Sending...")
                                    intoSelector.html("").load(url, params, callback);
                                }

                                function noteOnInputFor( attribute, tableName, id ) //, saveFunction // This needs to be fixed!
                                {
                                    let element = $('#'+tableName+'_'+id+'_'+attribute+'_span');
                                    element.attr('value',parseInt(element.attr('value'))+1);
                                    let title = $('#'+tableName+'_'+id+'_buttons').find('.TitleBadge');
                                    let count = parseInt(element.attr('value'));
                                    if( count > 0 ) {
                                        count = (count <= 255) ? count : 255;
                                        let redness = (130+125*(count/255));
                                        element.css("color", "rgb("+count+", 0, 0)");
                                        title.css("background-color", "rgb("+redness+", "+(255-count)+", "+(255-redness)+")");
                                        title.css("color", "rgb("+count+", "+redness+", "+count+")");
                                        let text = title.html();
                                        if ( !text.endsWith(" (unsaved)") ) {
                                            title.html(title.html()+" (unsaved)");
                                        }
                                    }
                                }

                                function switchTab(src, target) {
                                    var tabBody = $(src.target).parent().parent().find('.tabBody');
                                    tabBody.children().css("display", "none");
                                    $(src.target).siblings().removeClass("selected");
                                    $(src.target).addClass("selected");
                                    $(src.target).parent().parent().children('.tabBody').children(target).css("display", "flex");
                                }
                            </script>
                            <div id="dynamic_content">
                            </div>
                        </div>
                    </div>
                </main>
                <footer>
                    <section>
                        <ul>
                            <h4>
                                Contact:
                            </h4>
                            <li>
                                <a>
                                    danneydan@gmx.at
                                </a>
                            </li>
                            <li>
                                <a>
                                    gleethos@gmx.at
                                </a>
                            </li>
                        </ul>
                    </section>
                </footer>
            </div>
        </div>

        <script>
            VANTA.BIRDS({
                el: "#BirdBox",
                backgroundColor: 0x0,
                color1: 0x59cc65,
                color2: 0xa6fc,
                colorMode: "lerp",
                birdSize: 0.70,
                wingSpan: 17.00,
                speedLimit: 4.00,
                separation: 21.00,
                alignment: 16.00,
                cohesion: 25.00,
                backgroundAlpha: 0.00
            })
        </script>
    </body>
</html>
